–û—à–∏–±–∫–∞ ORA-00060: deadlock detected while waiting for resource –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –¥–≤–∞ (–∏–ª–∏ –±–æ–ª–µ–µ) —Å–µ–∞–Ω—Å–∞ –≤ Oracle –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞,
 –∏ –Ω–∏ –æ–¥–∏–Ω –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É, –ø–æ–∫–∞ Oracle –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö, —á—Ç–æ–±—ã —Ä–∞–∑–æ—Ä–≤–∞—Ç—å "–ø–µ—Ç–ª—é".
üîç –ß—Ç–æ —Ç–∞–∫–æ–µ deadlock (–≤–∑–∞–∏–º–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)?

–≠—Ç–æ —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞:

    –°–µ—Å—Å–∏—è A –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—á–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Å–µ—Å—Å–∏—è B.

    –°–µ—Å—Å–∏—è B –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—á–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Å–µ—Å—Å–∏—è A.

    –û–±–µ —Å–µ—Å—Å–∏–∏ –∂–¥—É—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ.

üîß –ö–∞–∫ —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å ORA-00060
‚úÖ 1. –ù–∞–π—Ç–∏ –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é

Oracle –ø–∏—à–µ—Ç –¥–µ—Ç–∞–ª–∏ deadlock –≤ trace-—Ñ–∞–π–ª, –¥–æ—Å—Ç—É–ø–Ω—ã–π —á–µ—Ä–µ–∑ alert.log.

–ß—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –µ–≥–æ:

SELECT value FROM v$diag_info WHERE name = 'Diag Trace';

–¢–∞–º –≤—ã –Ω–∞–π–¥—ë—Ç–µ –ø–æ–¥—Ä–æ–±–Ω—ã–π —Ç—Ä–µ–π—Å-—Ñ–∞–π–ª —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∏ –Ω–æ–º–µ—Ä–∞–º–∏ —Å—Ç—Ä–æ–∫.
‚úÖ 2. –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É–¥–µ—Ä–∂–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

    –ù–µ –¥–µ—Ä–∂–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –¥–æ–ª–≥–æ.

    –ù–µ –æ–∂–∏–¥–∞—Ç—å –≤–≤–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

    –í—Å–µ–≥–¥–∞ COMMIT –∏–ª–∏ ROLLBACK –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ.

‚úÖ 3. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–∞–±–ª–∏—Ü–∞–º

–ï—Å–ª–∏ –≤–∞—à–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —Ç–∞–±–ª–∏—Ü–∞–º, –≤—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π—Ç–µ —ç—Ç–æ –≤ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º –ø–æ—Ä—è–¥–∫–µ.

–ü—Ä–∏–º–µ—Ä:

-- –ü–ª–æ—Ö–æ:
-- —Å–µ—Å—Å–∏—è 1: UPDATE A ‚Üí UPDATE B
-- —Å–µ—Å—Å–∏—è 2: UPDATE B ‚Üí UPDATE A

-- –•–æ—Ä–æ—à–æ:
-- –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: UPDATE A ‚Üí UPDATE B

‚úÖ 4. –ò–∑–æ–ª—è—Ü–∏—è –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

    –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SELECT FOR UPDATE —Å —É–º–æ–º.

    –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ NOWAIT –∏–ª–∏ SKIP LOCKED, –µ—Å–ª–∏ –ø–æ–¥—Ö–æ–¥—è—â–µ:

SELECT * FROM jobs WHERE status = 'PENDING' FOR UPDATE SKIP LOCKED;

‚úÖ 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è:

SELECT * FROM dba_blockers;
SELECT * FROM dba_waiters;
SELECT * FROM v$lock;

–ò–ª–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —á–µ—Ä–µ–∑:

SELECT s1.sid || ',' || s2.sid AS deadlock_pair,
       s1.username AS user1,
       s2.username AS user2
FROM v$lock l1, v$session s1,
     v$lock l2, v$session s2
WHERE s1.sid = l1.sid
  AND s2.sid = l2.sid
  AND l1.BLOCK = 1
  AND l2.request > 0
  AND l1.id1 = l2.id1
  AND l1.id2 = l2.id2;

üõ† –ü—Ä–µ–≤–µ–Ω—Ç–∏–≤–Ω—ã–µ –º–µ—Ä—ã
–ú–µ—Ç–æ–¥	–û–±—ä—è—Å–Ω–µ–Ω–∏–µ
–ë—ã—Å—Ç—Ä—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏	–ú–µ–Ω—å—à–µ —à–∞–Ω—Å "–ø–æ–≤–∏—Å–Ω—É—Ç—å"
–£–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø	–ò–∑–±–µ–≥–∞–µ—Ç –ø–µ—Ä–µ–∫—Ä—ë—Å—Ç–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
FOR UPDATE SKIP LOCKED	–û–±—Ö–æ–¥ —É–∂–µ –∑–∞–Ω—è—Ç—ã—Ö —Å—Ç—Ä–æ–∫
–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ/–∞—É–¥–∏—Ç	–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π	–ß—Ç–æ–±—ã –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ deadlock –∑–∞—Ä–∞–Ω–µ–µ
