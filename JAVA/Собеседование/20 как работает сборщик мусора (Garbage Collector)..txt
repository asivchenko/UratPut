
üîπ –ß—Ç–æ —Ç–∞–∫–æ–µ Garbage Collector (GC)?

Garbage Collector ‚Äî —ç—Ç–æ —á–∞—Å—Ç—å JVM, –∫–æ—Ç–æ—Ä–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å, —É–¥–∞–ª—è—è –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏–∑ –∫—É—á–∏ (heap).

    –ï—Å–ª–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å —Å—Å—ã–ª–æ–∫, –æ–Ω —Å—á–∏—Ç–∞–µ—Ç—Å—è "–º—É—Å–æ—Ä–æ–º" –∏ –ø–æ–¥–ª–µ–∂–∏—Ç —É–¥–∞–ª–µ–Ω–∏—é.

üîß –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä:

public void example() {
    String a = new String("Test");
    a = null; // —Ç–µ–ø–µ—Ä—å –Ω–∞ –æ–±—ä–µ–∫—Ç "Test" –Ω–µ—Ç —Å—Å—ã–ª–æ–∫
    // ‚Üí –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–∞–ª—ë–Ω GC
}

üîπ –ö–∞–∫ GC –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —á—Ç–æ –æ–±—ä–µ–∫—Ç "–Ω–µ –Ω—É–∂–µ–Ω"?

JVM —Å—Ç—Ä–æ–∏—Ç –≥—Ä–∞—Ñ –¥–æ—Å—Ç–∏–∂–∏–º–æ—Å—Ç–∏ (reachability):

    –í—Å—ë –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å GC Roots:

        –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Å—Ç–µ–∫–µ,

        —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è,

        –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –∏ —Ç.–¥.

    –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –Ω–µ –¥–æ—Å—Ç–∏–∂–∏–º –æ—Ç GC Roots ‚Üí –æ–Ω —Å—á–∏—Ç–∞–µ—Ç—Å—è –º—É—Å–æ—Ä–æ–º.

üîπ –≠—Ç–∞–ø—ã —Ä–∞–±–æ—Ç—ã GC:

    –ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ (Mark)
    –ù–∞–π—Ç–∏ –≤—Å–µ –¥–æ—Å—Ç–∏–∂–∏–º—ã–µ –æ–±—ä–µ–∫—Ç—ã.

    –£–¥–∞–ª–µ–Ω–∏–µ (Sweep)
    –£–¥–∞–ª–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º—ã–µ –æ–±—ä–µ–∫—Ç—ã.

    –ö–æ–º–ø–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Compact) (–≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–∞—Ö)
    –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∂–∏–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—é –ø–∞–º—è—Ç–∏.

üîπ –ü–æ–∫–æ–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ (Generational GC)

–ö—É—á–∞ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ –ø–æ–∫–æ–ª–µ–Ω–∏—è, —á—Ç–æ–±—ã —É—Å–∫–æ—Ä–∏—Ç—å —Å–±–æ—Ä–∫—É:
–û–±–ª–∞—Å—Ç—å	–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
Young (–º–æ–ª–æ–¥–æ–µ) –ø–æ–∫–æ–ª–µ–Ω–∏–µ	–ù–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã. –ß–∞—Å—Ç–æ —É–º–∏—Ä–∞—é—Ç –±—ã—Å—Ç—Ä–æ
Old (tenured) –ø–æ–∫–æ–ª–µ–Ω–∏–µ	–û–±—ä–µ–∫—Ç—ã, –ø–µ—Ä–µ–∂–∏–≤—à–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–±–æ—Ä–æ–∫
Metaspace	–ö–ª–∞—Å—Å—ã –∏ –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (—Å Java 8)
üîÑ –¢–∏–ø—ã —Å–±–æ—Ä–æ–∫:
–°–±–æ—Ä–∫–∞	–û–ø–∏—Å–∞–Ω–∏–µ
Minor GC	–¢–æ–ª—å–∫–æ –≤ Young-–ø–æ–∫–æ–ª–µ–Ω–∏–∏
Major / Full GC	–í–æ –≤—Å–µ–π –∫—É—á–µ (Old + Young)
Stop-the-world	–í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞—É–∑–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤–æ –≤—Ä–µ–º—è GC
üîπ –ê–ª–≥–æ—Ä–∏—Ç–º—ã GC –≤ JVM
–ê–ª–≥–æ—Ä–∏—Ç–º	–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
Serial GC	–û–¥–∏–Ω –ø–æ—Ç–æ–∫, –ø—Ä–æ—Å—Ç–æ–π, -XX:+UseSerialGC
Parallel GC	–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–π, –±—ã—Å—Ç—Ä–µ–µ, -XX:+UseParallelGC
CMS (—É—Å—Ç–∞—Ä–µ–ª)	Concurrent Mark Sweep, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
G1 GC	–£–º–Ω—ã–π, –¥–µ–ª–∏—Ç –∫—É—á—É –Ω–∞ —Ä–µ–≥–∏–æ–Ω—ã, -XX:+UseG1GC
ZGC / Shenandoah	–ù–∏–∑–∫–∏–µ –ø–∞—É–∑—ã, –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
üîß –ö–∞–∫ —É–ø—Ä–∞–≤–ª—è—Ç—å GC –≤ JVM:

    –ò–∑–º–µ–Ω–∏—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º:

java -XX:+UseG1GC MyApp

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–∑–º–µ—Ä –∫—É—á–∏:

java -Xms512m -Xmx1024m MyApp

–í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ GC:

    java -Xlog:gc MyApp

üî• –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏:

    –ß—Ç–æ —Ç–∞–∫–æ–µ Stop-the-world –ø–∞—É–∑–∞?

    –ö–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è finalize()? –ü–æ—á–µ–º—É –æ–Ω —É—Å—Ç–∞—Ä–µ–ª?

    –ß—Ç–æ –¥–µ–ª–∞–µ—Ç System.gc()? (‚Üí —Ç–æ–ª—å–∫–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç, –Ω–æ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–±–æ—Ä–∫—É)

    –ß—Ç–æ —Ç–∞–∫–æ–µ —É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ –≤ Java, –µ—Å–ª–∏ –µ—Å—Ç—å GC? (‚Üí –æ–±—ä–µ–∫—Ç –∂–∏–≤, –Ω–æ –Ω–∞ –Ω–µ–≥–æ "–∑–∞–±—ã–ª–∏" —Å—Å—ã–ª–∫—É –æ—á–∏—Å—Ç–∏—Ç—å)

üß† –í—ã–≤–æ–¥:

    GC = –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞ –≤ –∫—É—á–µ

    –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ –≥—Ä–∞—Ñ–µ –¥–æ—Å—Ç–∏–∂–∏–º–æ—Å—Ç–∏

    –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º –∏ –ø–æ–∫–æ–ª–µ–Ω–∏—è–º

    –ü–æ–º–æ–≥–∞–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å —É—Ç–µ—á–µ–∫, –Ω–æ –Ω–µ –∏–∑–±–∞–≤–ª—è–µ—Ç –æ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –º–æ–≥—É:

    –ü–æ–∫–∞–∑–∞—Ç—å –≤–∏–∑—É–∞–ª—å–Ω–æ, –∫–∞–∫ GC –æ—á–∏—â–∞–µ—Ç –ø–∞–º—è—Ç—å

    –î–∞—Ç—å –∑–∞–¥–∞—á—É: –Ω–∞–π—Ç–∏ –∏ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å —É—Ç–µ—á–∫—É –ø–∞–º—è—Ç–∏

    –û–±—ä—è—Å–Ω–∏—Ç—å, –∫–∞–∫–æ–π GC –≤—ã–±—Ä–∞—Ç—å –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, G1 vs ZGC)

–í—ã —Å–∫–∞–∑–∞–ª–∏:
–ø–æ—è—Å–Ω–µ–Ω–∏–µ java -Xms512m -Xmx1024m MyApp 
ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å ‚Äî –∫–ª—é—á–µ–≤–æ–π –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞–º—è—Ç–∏ JVM, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–º–∏ –∏–ª–∏ –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–º–∏ Java-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏.
üîπ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–º–∞–Ω–¥–∞:

java -Xms512m -Xmx1024m MyApp

–≠—Ç–æ –∑–∞–ø—É—Å–∫ Java-–ø—Ä–æ–≥—Ä–∞–º–º—ã (MyApp) —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π —Ä–∞–∑–º–µ—Ä–∞ –∫—É—á–∏ (heap):
–ü–∞—Ä–∞–º–µ—Ç—Ä	–ó–Ω–∞—á–µ–Ω–∏–µ
-Xms512m	–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫—É—á–∏ = 512 –º–µ–≥–∞–±–∞–π—Ç
-Xmx1024m	–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫—É—á–∏ = 1024 –º–µ–≥–∞–±–∞–π—Ç (1 –ì–ë)
üîß –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

    –£–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ–º –ø–∞–º—è—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º

    –ò–∑–±–µ–∂–∞—Ç—å –Ω–µ–Ω—É–∂–Ω—ã—Ö —É–≤–µ–ª–∏—á–µ–Ω–∏–π –∫—É—á–∏ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã

    –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–±–æ—Ä—â–∏–∫–∞ –º—É—Å–æ—Ä–∞ (GC)

    –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–æ–¥ —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã —Å–µ—Ä–≤–µ—Ä–∞

üìå –ß—Ç–æ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å:

    JVM —Å—Ä–∞–∑—É –≤—ã–¥–µ–ª–∏—Ç 512MB –¥–ª—è –∫—É—á–∏ (–Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä)

    –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–µ—Ç —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–æ 1024MB, –Ω–æ –Ω–µ –±–æ–ª—å—à–µ

    –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç–∞–º –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –ø–∞–º—è—Ç–∏ ‚Äî –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω GC –∏–ª–∏ –¥–∞–∂–µ –≤—ã–±—Ä–æ—à–µ–Ω OutOfMemoryError

üß† –ü—Ä–∏–º–µ—Ä —Å–∏—Ç—É–∞—Ü–∏–π:
–°–∏—Ç—É–∞—Ü–∏—è	–†–µ–∑—É–ª—å—Ç–∞—Ç
–£—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ -Xmx128m, –∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç 300MB	OutOfMemoryError: Java heap space
–£—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ -Xms –∏ -Xmx –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏	–ò–∑–±–µ–≥–∞–µ—Ç–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–æ—Å—Ç–∞ ‚Äî –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞
–ù–µ –∑–∞–¥–∞–ª–∏ -Xmx –≤–æ–æ–±—â–µ	JVM –≤–æ–∑—å–º—ë—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–æ–±—ã—á–Ω–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –û–° –∏ –≤–µ—Ä—Å–∏–∏ JVM)
‚ö†Ô∏è –í–∞–∂–Ω–æ:

    –ü–∞–º—è—Ç—å –∫—É—á–∏ (heap) ‚â† –≤—Å—è –ø–∞–º—è—Ç—å, –∫–æ—Ç–æ—Ä—É—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JVM.

    –¢–∞–∫–∂–µ –µ—Å—Ç—å:

        –ú–µ—Ç–∞—Å–ø–µ–π—Å (Metaspace) ‚Äî –¥–ª—è –∫–ª–∞—Å—Å–æ–≤ –∏ –æ—Ç—Ä–∞–∂–µ–Ω–∏—è

        –°—Ç–µ–∫ (stack) ‚Äî –¥–ª—è –≤—ã–∑–æ–≤–æ–≤ –º–µ—Ç–æ–¥–æ–≤

        Native memory ‚Äî –¥–ª—è –Ω–∞—Ç–∏–≤–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –∏ GC

    –û–±—â–∏–π RSS –ø—Ä–æ—Ü–µ—Å—Å–∞ –±—É–¥–µ—Ç –±–æ–ª—å—à–µ, —á–µ–º -Xmx

üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –ø–∞–º—è—Ç–∏ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:

–í—ã –º–æ–∂–µ—Ç–µ —Å–ª–µ–¥–∏—Ç—å –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–∞–º—è—Ç–∏ —Å –ø–æ–º–æ—â—å—é:

    jconsole

    jvisualvm

    -Xlog:gc* –∏–ª–∏ -verbose:gc

    jstat -gc <pid> 1000

üßæ –í—ã–≤–æ–¥:
–ö–ª—é—á	–ß—Ç–æ –¥–µ–ª–∞–µ—Ç
-Xms	–ù–∞—á–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫—É—á–∏
-Xmx	–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫—É—á–∏
–û–±–∞	–ü–æ–∑–≤–æ–ª—è—é—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ GC