–ß—Ç–æ —Ç–∞–∫–æ–µ read consistency


Read Consistency (–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏) –≤ Oracle ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—â–∏–π, —á—Ç–æ –ª—é–±–æ–π SQL-–∑–∞–ø—Ä–æ—Å –≤–∏–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ç–æ–º –≤–∏–¥–µ, –≤ –∫–∞–∫–æ–º –æ–Ω–∏ –±—ã–ª–∏ –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –¥—Ä—É–≥–∏–µ —Å–µ—Å—Å–∏–∏ –≤ —ç—Ç–æ –≤—Ä–µ–º—è –∏–∑–º–µ–Ω—è—é—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ.
üß† –ü—Ä–æ—â–µ –≥–æ–≤–æ—Ä—è:

    –¢–≤–æ–π SELECT –≤—Å–µ–≥–¥–∞ —á–∏—Ç–∞–µ—Ç –Ω–µ "—Ç–µ–∫—É—â–∏–µ" –¥–∞–Ω–Ω—ã–µ, –∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—É—é –∫–æ–ø–∏—é ‚Äî —Ç—É, —á—Ç–æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞ –∑–∞–ø—Ä–æ—Å–∞.

üîç –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

    –ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å ¬´–≥—Ä—è–∑–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è¬ª (dirty reads)

    –ß—Ç–æ–±—ã –Ω–µ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –¥—Ä—É–≥–∏—Ö –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

    –ß—Ç–æ–±—ã –∏–º–µ—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–±–æ—Ä–∫–∏, –¥–∞–∂–µ –µ—Å–ª–∏ –¥—Ä—É–≥–∏–µ –≤ —ç—Ç–æ –≤—Ä–µ–º—è –≤–Ω–æ—Å—è—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è

‚úÖ –ü—Ä–∏–º–µ—Ä:
‚ñ∂Ô∏è –°–µ—Å—Å–∏—è 1:

BEGIN;
UPDATE employees SET salary = 99999 WHERE employee_id = 100;
-- COMMIT –µ—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω

‚ñ∂Ô∏è –°–µ—Å—Å–∏—è 2:

SELECT salary FROM employees WHERE employee_id = 100;

üî∏ –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ —Å–µ—Å—Å–∏—è 1 —É–∂–µ –∏–∑–º–µ–Ω–∏–ª–∞ –∑–∞—Ä–ø–ª–∞—Ç—É, —Å–µ—Å—Å–∏—è 2 —É–≤–∏–¥–∏—Ç —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ Oracle –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç read consistency.
üß∞ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Oracle

Oracle –∏—Å–ø–æ–ª—å–∑—É–µ—Ç UNDO-—Å–µ–≥–º–µ–Ω—Ç—ã, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å ¬´–ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é —Å—Ç—Ä–æ–∫–∏¬ª –¥–ª—è —á—Ç–µ–Ω–∏—è.

    –ö–æ–≥–¥–∞ —Å—Ç—Ä–æ–∫–∞ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è, Oracle —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ UNDO.

    –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ —á–∏—Ç–∞–µ—Ç —ç—Ç—É —Å—Ç—Ä–æ–∫—É –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Äî Oracle –∏—Å–ø–æ–ª—å–∑—É–µ—Ç UNDO, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –≤–µ—Ä—Å–∏—é "–Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–ø—Ä–æ—Å–∞".

üìå –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:
–°–≤–æ–π—Å—Ç–≤–æ	–ó–Ω–∞—á–µ–Ω–∏–µ
–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å	Oracle —Ä–µ–∞–ª–∏–∑—É–µ—Ç READ COMMITTED –∏ SERIALIZABLE —É—Ä–æ–≤–Ω–∏
–ù–µ—Ç –≥—Ä—è–∑–Ω—ã—Ö —á—Ç–µ–Ω–∏–π	SELECT –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–∏–¥–∏—Ç –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç UNDO	–î–∞ ‚Äî —á–∏—Ç–∞–µ–º –ø—Ä–æ—à–ª—É—é –≤–µ—Ä—Å–∏—é —Å—Ç—Ä–æ–∫–∏
–ù–∞ —É—Ä–æ–≤–Ω–µ –∑–∞–ø—Ä–æ—Å–∞	Read Consistency –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è –¥–ª—è –≤—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞, –∞ –Ω–µ –¥–ª—è –≤—Å–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
üîí –£—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏ –≤ Oracle
–£—Ä–æ–≤–µ–Ω—å –∏–∑–æ–ª—è—Ü–∏–∏	–ü–æ–≤–µ–¥–µ–Ω–∏–µ
READ COMMITTED	–ö–∞–∂–¥–æ–µ —á—Ç–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –Ω–æ–≤–∞—è ¬´—Å–Ω–∏–º–∫–∞¬ª
SERIALIZABLE	–í—Å–µ —á—Ç–µ–Ω–∏—è ‚Äî –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

    ORA-01555: snapshot too old ‚Äî –µ—Å–ª–∏ UNDO —É–∂–µ —É–¥–∞–ª—ë–Ω, Oracle –Ω–µ –º–æ–∂–µ—Ç –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å.

        –†–µ—à–µ–Ω–∏–µ: —É–≤–µ–ª–∏—á–∏—Ç—å UNDO_RETENTION –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å –º–µ–Ω–µ–µ —Ç—è–∂—ë–ª—ã–º.

üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Ç–µ—Å—Ç–µ:

-- –°–µ—Å—Å–∏—è 1
UPDATE products SET price = 500 WHERE id = 1;

-- –ù–ï –¥–µ–ª–∞–π COMMIT

-- –°–µ—Å—Å–∏—è 2 (–≤ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ):
SELECT price FROM products WHERE id = 1;
-- –¢—ã —É–≤–∏–¥–∏—à—å —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

