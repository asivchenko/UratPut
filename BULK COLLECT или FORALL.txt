–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! BULK COLLECT –∏ FORALL ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –º–∞—Å—Å–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ PL/SQL, –∫–æ—Ç–æ—Ä—ã–µ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —É—Å–∫–æ—Ä—è—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, —É—Å—Ç—Ä–∞–Ω—è—è –ø–æ—Å—Ç—Ä–æ—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.
üìå –ß—Ç–æ —Ç–∞–∫–æ–µ BULK COLLECT?

–ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –º–Ω–æ–≥–æ —Å—Ç—Ä–æ–∫ –∏–∑ SQL-–∑–∞–ø—Ä–æ—Å–∞ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é (–º–∞—Å—Å–∏–≤) –∑–∞ –æ–¥–∏–Ω —à–∞–≥, –≤–º–µ—Å—Ç–æ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ FETCH.
üìå –ß—Ç–æ —Ç–∞–∫–æ–µ FORALL?

–ü–æ–∑–≤–æ–ª—è–µ—Ç –º–∞—Å—Å–æ–≤–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å DML (INSERT, UPDATE, DELETE) –ø–æ —ç–ª–µ–º–µ–Ω—Ç–∞–º –º–∞—Å—Å–∏–≤–∞ –∑–∞ –æ–¥–∏–Ω SQL-–∑–∞–ø—Ä–æ—Å, –±–µ–∑ —Ü–∏–∫–ª–∞.
‚úÖ –ü—Ä–∏–º–µ—Ä: BULK COLLECT + FORALL

DECLARE
  TYPE t_id_tab IS TABLE OF employees.employee_id%TYPE;
  TYPE t_sal_tab IS TABLE OF employees.salary%TYPE;

  v_ids  t_id_tab;
  v_sals t_sal_tab;

BEGIN
  -- 1. BULK COLLECT: –º–∞—Å—Å–æ–≤–æ –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –º–∞—Å—Å–∏–≤—ã
  SELECT employee_id, salary
  BULK COLLECT INTO v_ids, v_sals
  FROM employees
  WHERE department_id = 10;

  -- 2. FORALL: –º–∞—Å—Å–æ–≤–æ –æ–±–Ω–æ–≤–ª—è–µ–º –∑–∞—Ä–ø–ª–∞—Ç—ã
  FORALL i IN 1 .. v_ids.COUNT
    UPDATE employees
    SET salary = v_sals(i) * 1.10
    WHERE employee_id = v_ids(i);

  COMMIT;
END;

üîπ –≠—Ç–æ—Ç –∫–æ–¥ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ –æ—Ç–¥–µ–ª–∞ 10 –Ω–∞ 10%.
‚ö° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å	–ß—Ç–æ –¥–∞—ë—Ç
BULK COLLECT	–ß—Ç–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫ —Å—Ä–∞–∑—É –≤ –ø–∞–º—è—Ç—å
FORALL	–ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ‚Äî –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º —Ü–∏–∫–ª
–≠–∫–æ–Ω–æ–º–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π –º–µ–∂–¥—É SQL –∏ PL/SQL	–î–∞, –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ
–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å	–í—ã–∏–≥—Ä—ã—à –≤ 10‚Äì50 —Ä–∞–∑ –Ω–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–∞—Ö
üß† –í–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏
üî∏ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ–±—ä—ë–º–∞ ‚Äî LIMIT (–ø—Ä–∏ BULK COLLECT –≤ —Ü–∏–∫–ª):

LOOP
  FETCH cur BULK COLLECT INTO v_tab LIMIT 1000;
  EXIT WHEN v_tab.COUNT = 0;

  FORALL i IN 1 .. v_tab.COUNT
    INSERT INTO archive_table VALUES v_tab(i);

  v_tab.DELETE;
END LOOP;

üî∏ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ FORALL:

FORALL i IN 1 .. v_ids.COUNT SAVE EXCEPTIONS
  DELETE FROM employees WHERE employee_id = v_ids(i);

EXCEPTION
  WHEN OTHERS THEN
    FOR i IN 1 .. SQL%BULK_EXCEPTIONS.COUNT LOOP
      DBMS_OUTPUT.PUT_LINE(
        '–û—à–∏–±–∫–∞ –Ω–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ ' || SQL%BULK_EXCEPTIONS(i).ERROR_INDEX ||
        ': ' || SQLERRM(-SQL%BULK_EXCEPTIONS(i).ERROR_CODE));
    END LOOP;

üìã –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
–°—Ü–µ–Ω–∞—Ä–∏–π	–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
–ú–∞—Å—Å–æ–≤–æ–µ —á—Ç–µ–Ω–∏–µ –≤ PL/SQL	BULK COLLECT
–ú–∞—Å—Å–æ–≤–æ–µ DML-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/–≤—Å—Ç–∞–≤–∫–∞	FORALL
–ù—É–∂–Ω–æ –º–∞–∫—Å–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å	–û–±–∞ –≤–º–µ—Å—Ç–µ
–û–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö ‚Äî —Ç—ã—Å—è—á–∏ —Å—Ç—Ä–æ–∫ –∏ –±–æ–ª–µ–µ	–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
üö´ –ö–æ–≥–¥–∞ –Ω–µ –Ω—É–∂–Ω–æ

    –ï—Å–ª–∏ –≤—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç–µ 1‚Äì2 —Å—Ç—Ä–æ–∫–∏

    –ï—Å–ª–∏ –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö ‚Üí –º–∏–ª–ª–∏–æ–Ω—ã —Å—Ç—Ä–æ–∫, –±–µ–∑ LIMIT ‚Üí –ø–µ—Ä–µ–ø–æ–ª–Ω–∏—Ç—Å—è PGA (–æ–ø–µ—Ä–∞—Ç–∏–≤–∫–∞)

–•–æ—á–µ—à—å ‚Äî –º–æ–≥—É:

    –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ CURSOR vs BULK COLLECT –ø–æ –≤—Ä–µ–º–µ–Ω–∏

    –¥–∞—Ç—å —à–∞–±–ª–æ–Ω —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ—à–∏–±–æ–∫ –≤ FORALL

    –ø–æ–º–æ—á—å —Å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–æ–º —Ç–≤–æ–µ–≥–æ –∫–æ–¥–∞ –Ω–∞ BULK-—Å—Ç–∏–ª—å