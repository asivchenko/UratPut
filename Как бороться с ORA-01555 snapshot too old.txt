–ö–∞–∫ –±–æ—Ä–æ—Ç—å—Å—è —Å ORA-01555: snapshot too old?
ChatGPT —Å–∫–∞–∑–∞–ª:

–û—à–∏–±–∫–∞ ORA-01555: snapshot too old ‚Äî –æ–¥–Ω–∞ –∏–∑ —Å–∞–º—ã—Ö –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∏ –Ω–µ–ø—Ä–∏—è—Ç–Ω—ã—Ö –≤ Oracle. –û–Ω–∞ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ Oracle –Ω–µ —Å–º–æ–≥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ UNDO-—Å–µ–≥–º–µ–Ω—Ç –±—ã–ª –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —á—Ç–µ–Ω–∏—è.
üìå –ß—Ç–æ —Ç–∞–∫–æ–µ ORA-01555?

    –û—à–∏–±–∫–∞ –æ–∑–Ω–∞—á–∞–µ—Ç: "Oracle –Ω–µ –º–æ–∂–µ—Ç –æ–±–µ—Å–ø–µ—á–∏—Ç—å read consistency, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω—É–∂–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å—Ç—Ä–æ–∫–∏ —É–∂–µ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ UNDO."

–ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –¥–æ–ª–≥–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö, –µ—Å–ª–∏:

    –ó–∞–ø—Ä–æ—Å —á–∏—Ç–∞–µ—Ç –º–Ω–æ–≥–æ —Å—Ç—Ä–æ–∫ –∏–ª–∏ –¥–µ–ª–∞–µ—Ç —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É,

    –ê –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –¥—Ä—É–≥–∏–µ —Å–µ—Å—Å–∏–∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ,

    –ò Oracle –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é —Å—Ç—Ä–æ–∫–∏ –≤ UNDO.

üß† –¢–∏–ø–∏—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:

-- –ó–∞–ø—Ä–æ—Å –¥–æ–ª–≥–æ —á–∏—Ç–∞–µ—Ç –±–æ–ª—å—à—É—é —Ç–∞–±–ª–∏—Ü—É:
SELECT * FROM big_table WHERE ...;

-- –ê –≤ —ç—Ç–æ –≤—Ä–µ–º—è –¥—Ä—É–≥–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç UPDATE:
UPDATE big_table SET ...;

-- –ï—Å–ª–∏ UNDO –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω ‚Äî –ø–æ–ª—É—á–∏–º:
ORA-01555: snapshot too old

‚úÖ –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å ORA-01555
üîπ 1. –£–≤–µ–ª–∏—á–∏—Ç—å UNDO_RETENTION

ALTER SYSTEM SET UNDO_RETENTION = 900; -- —Å–µ–∫—É–Ω–¥

    –≠—Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç "–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏" UNDO –¥–æ 15 –º–∏–Ω—É—Ç.

‚úÖ –õ—É—á—à–µ –∑–∞–¥–∞–≤–∞—Ç—å —Å –∑–∞–ø–∞—Å–æ–º: 15‚Äì30 –º–∏–Ω—É—Ç –¥–ª—è OLAP/–æ—Ç—á—ë—Ç–æ–≤.
üîπ 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å READ ONLY —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –æ—Ç—á—ë—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

SET TRANSACTION READ ONLY;
SELECT ... FROM big_table;

üìå –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∏ —É–ª—É—á—à–∞–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ UNDO.
üîπ 3. –ò–∑–±–µ–≥–∞—Ç—å PL/SQL-—Ü–∏–∫–ª–æ–≤ –ø–æ –∫—É—Ä—Å–æ—Ä—É —Å –º–µ–¥–ª–µ–Ω–Ω—ã–º FETCH

-- –ü–õ–û–•–û (–¥–æ–ª–≥–æ —Ç—è–Ω–µ—Ç –∫—É—Ä—Å–æ—Ä):
FOR rec IN (SELECT * FROM big_table WHERE ...) LOOP
  ...
END LOOP;

‚úÖ –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å BULK COLLECT + LIMIT, —á—Ç–æ–±—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–∞—á–∫–∞–º–∏.
üîπ 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PGA –≤–º–µ—Å—Ç–æ TEMP –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–æ–∫ (–µ—Å–ª–∏ –º–æ–∂–Ω–æ)

    ORA-01555 –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å –≤ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞—Ö, –µ—Å–ª–∏ Oracle –≤—ã–Ω—É–∂–¥–µ–Ω –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ TEMP-—Ç–∞–±–ª–∏—Ü–∞–º.

    –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏ –¥–ª—è PGA_AGGREGATE_TARGET.

üîπ 5. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã: —É–º–µ–Ω—å—à–∏—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

    –î–æ–±–∞–≤—å—Ç–µ –∏–Ω–¥–µ–∫—Å—ã

    –†–∞–∑–±–µ–π—Ç–µ –Ω–∞ –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã

    –î–æ–±–∞–≤—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã (—Å—É–∂–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∫–∏)

üîπ 6. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Materialized View –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —Å—Ç–∞–±–∏–ª—å–Ω–æ –¥–æ–ª–≥–∏–π ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ GLOBAL TEMPORARY TABLE –∏–ª–∏ MATERIALIZED VIEW.
üîç –ö–∞–∫ —É–∑–Ω–∞—Ç—å —Ç–µ–∫—É—â—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É UNDO

SHOW PARAMETER undo_retention;

–ò–ª–∏:

SELECT retention FROM dba_undo_extents WHERE status = 'ACTIVE';

‚ùå –ß—Ç–æ –Ω–µ –ø–æ–º–æ–∂–µ—Ç:

    –£–≤–µ–ª–∏—á–µ–Ω–∏–µ UNDO_RETENTION, –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ undo tablespace

    COMMIT –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –∫—É—Ä—Å–æ—Ä–∞ ‚Äî —ç—Ç–æ –º–æ–∂–µ—Ç –¥–∞–∂–µ —É—Å—É–≥—É–±–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É (–æ—à–∏–±–∫–∞ —Å–º–µ—Å—Ç–∏—Ç—Å—è)

    –†–∞–±–æ—Ç–∞ —Å FOR UPDATE ‚Äî –Ω–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É snapshot

üßæ –í—ã–≤–æ–¥:
–ß—Ç–æ –¥–µ–ª–∞—Ç—å	–ó–∞—á–µ–º
–£–≤–µ–ª–∏—á–∏—Ç—å UNDO_RETENTION	–ß—Ç–æ–±—ã Oracle –Ω–µ —É–¥–∞–ª—è–ª —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ –¥–∞–Ω–Ω—ã—Ö
–ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –∫—É—Ä—Å–æ—Ä—ã –Ω–∞ BULK COLLECT	–ß—Ç–æ–±—ã —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –º–µ–∂–¥—É —á—Ç–µ–Ω–∏—è–º–∏ —Å—Ç—Ä–æ–∫
–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã	–£–º–µ–Ω—å—à–∏—Ç—å –≤—Ä–µ–º—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å—Ç—Ä–æ–∫–∞–º
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å READ ONLY	–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –º–æ–º–µ–Ω—Ç —á—Ç–µ–Ω–∏—è
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã	–ß—Ç–æ–±—ã –æ–±–æ–π—Ç–∏ –¥–æ–ª–≥–∏–µ SELECT'—ã